<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Chilena | Empanadas Premium</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <header>
        <nav>
            <div class="logo" onclick="window.location.reload()">ü•ü La Chilena</div>
            
            <div class="nav-group">
                <div id="auth-links">
                    <a href="#" class="nav-link" onclick="openModal('login-modal')">Ingresar</a>
                    <a href="#" class="nav-link" style="background:var(--chile-red); color:white;" onclick="openModal('register-modal')">Crear Cuenta</a>
                </div>

                <div id="user-info" class="hidden" style="display: flex; align-items: center; gap: 15px;">
                    <span style="font-weight:600;">Hola, <span id="user-name-display">User</span></span>
                    <a href="#" class="nav-link" onclick="openOrders()">Mis Pedidos</a>
                    <a href="#" id="admin-link" class="nav-link hidden" onclick="toggleAdmin()" style="color:var(--accent);">Admin</a>
                    <a href="#" class="nav-link" onclick="logout()">Salir</a>
                </div>

                <div class="cart-btn" onclick="toggleCart()">
                    üõí <span id="cart-count">0</span>
                </div>
            </div>
        </nav>
    </header>

    <div class="carousel-container" id="hero-carousel">
        <button class="c-btn c-prev" onclick="moveSlide(-1)">‚ùÆ</button>
        <button class="c-btn c-next" onclick="moveSlide(1)">‚ùØ</button>
        <div class="carousel-track" id="carousel-track"></div>
    </div>

    <section class="controls">
        <div class="search-box">
            <span>üîç</span>
            <input type="text" id="search-input" placeholder="¬øQu√© se te antoja hoy? (Ej: Pino, Bebida...)">
        </div>
        <select id="category-filter" class="cat-select">
            <option value="all">Todo el Men√∫</option>
            <option value="horno">De Horno</option>
            <option value="frita">Fritas</option>
            <option value="acompa√±amiento">Extras</option>
            <option value="bebida">Bebidas</option>
        </select>
    </section>

    <main>
        <div id="grid" class="grid"></div>
        <div id="empty-state" class="hidden" style="text-align:center; padding:4rem; color:#aaa;">
            <h3>No encontramos coincidencias üò¢</h3>
        </div>
    </main>

    <section id="admin-panel" class="admin-panel hidden">
        <div class="admin-tabs">
            <button class="tab active" onclick="switchTab('products')">üì¶ Inventario</button>
            <button class="tab" onclick="switchTab('sales')">üìä Ventas y M√©tricas</button>
        </div>

        <div id="view-products" class="admin-view active">
            <div class="admin-form" style="background:white; padding:20px; border-radius:16px; margin-bottom:20px; display:grid; grid-template-columns:repeat(auto-fit, minmax(140px, 1fr)); gap:15px;">
                <input class="input-field" type="number" id="adm-id" placeholder="ID">
                <input class="input-field" type="text" id="adm-name" placeholder="Nombre">
                <select class="input-field" id="adm-cat">
                    <option value="horno">Horno</option><option value="frita">Frita</option>
                    <option value="acompa√±amiento">Extra</option><option value="bebida">Bebida</option>
                </select>
                <input class="input-field" type="number" id="adm-price" placeholder="Precio">
                <input class="input-field" type="number" id="adm-stock" placeholder="Stock">
                <input class="input-field" type="text" id="adm-img" placeholder="URL Imagen">
                <button class="btn-primary" onclick="saveProduct()">Guardar</button>
                <button class="btn-secondary" onclick="clearForm()">Limpiar</button>
            </div>
            <table class="data-table">
                <thead><tr><th>ID</th><th>Producto</th><th>Precio</th><th>Stock</th><th>Acciones</th></tr></thead>
                <tbody id="adm-table-body"></tbody>
            </table>
        </div>

        <div id="view-sales" class="admin-view">
            <div style="background:white; padding:20px; border-radius:16px; height:350px; margin-bottom:20px;">
                <canvas id="salesChart"></canvas>
            </div>
            <table class="data-table">
                <thead><tr><th>ID</th><th>Cliente</th><th>Total</th><th>Detalle</th></tr></thead>
                <tbody id="adm-sales-body"></tbody>
            </table>
        </div>
    </section>

    <div id="login-modal" class="modal">
        <div class="modal-box">
            <span class="close" onclick="closeModal('login-modal')">√ó</span>
            <h2 style="margin-bottom:20px;">Bienvenido de vuelta</h2>
            <div class="input-group">
                <input type="text" id="login-user" class="input-field" placeholder="Correo o Usuario" tabindex="1" onkeydown="nextFocus(event, 'login-pass')">
            </div>
            <div class="input-group">
                <input type="password" id="login-pass" class="input-field" placeholder="Contrase√±a" tabindex="2" onkeydown="nextFocus(event, 'btn-login')">
            </div>
            <button id="btn-login" class="btn-primary" onclick="login()">Ingresar</button>
        </div>
    </div>

    <div id="register-modal" class="modal">
        <div class="modal-box">
            <span class="close" onclick="closeModal('register-modal')">√ó</span>
            <h2 style="margin-bottom:20px;">√önete a nosotros</h2>
            <input type="text" id="reg-name" class="input-field" placeholder="Nombre Completo" style="margin-bottom:10px;">
            <input type="email" id="reg-email" class="input-field" placeholder="Correo Electr√≥nico" style="margin-bottom:10px;">
            <input type="password" id="reg-pass" class="input-field" placeholder="Contrase√±a (m√≠n 8 chars)" style="margin-bottom:20px;">
            <button class="btn-primary" onclick="register()">Crear Cuenta</button>
        </div>
    </div>

    <div id="qty-modal" class="modal">
        <div class="modal-box" style="text-align:center;">
            <span class="close" onclick="closeModal('qty-modal')">√ó</span>
            <h2 id="qty-name">Producto</h2>
            <div class="qty-control">
                <button class="qty-btn" onclick="modQty(-1)">-</button>
                <span id="qty-val" style="font-size:2rem; font-weight:bold;">1</span>
                <button class="qty-btn" onclick="modQty(1)">+</button>
            </div>
            <button class="btn-primary" onclick="confirmAdd(false)">Agregar y Seguir</button>
            <button class="btn-secondary" onclick="confirmAdd(true)">Agregar y Pagar</button>
        </div>
    </div>

    <div id="history-modal" class="modal">
        <div class="modal-box" style="width:600px; max-width:95%;">
            <span class="close" onclick="closeModal('history-modal')">√ó</span>
            <h2>Mis Pedidos</h2>
            <div style="max-height:400px; overflow-y:auto; margin-top:15px;">
                <table class="data-table">
                    <thead><tr><th>ID</th><th>Total</th><th>Estado</th><th>Items</th></tr></thead>
                    <tbody id="history-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="checkout-modal" class="modal">
        <div class="modal-box">
            <span class="close" onclick="closeModal('checkout-modal')">√ó</span>
            <h2>Confirmar Compra</h2>
            <div style="background:#F7FAFC; padding:15px; border-radius:12px; margin:20px 0;">
                <p>Total a Pagar: <strong id="chk-total" style="color:var(--chile-red); font-size:1.2rem;"></strong></p>
                <p>Cliente: <span id="chk-email"></span></p>
            </div>
            <button class="btn-primary" onclick="processPayment()">‚úÖ Pagar Ahora</button>
        </div>
    </div>

    <div id="toast-box" class="toast-container"></div>

    <div id="cart-sidebar" class="cart-sidebar" style="position:fixed; top:0; right:-400px; width:350px; height:100%; background:white; z-index:2500; transition:right 0.3s ease; display:flex; flex-direction:column; box-shadow:-5px 0 15px rgba(0,0,0,0.1);">
        <div style="padding:20px; background:var(--chile-red); color:white; display:flex; justify-content:space-between; align-items:center;">
            <h3>Mi Canasta</h3>
            <span onclick="toggleCart()" style="cursor:pointer; font-size:1.5rem;">√ó</span>
        </div>
        <div id="cart-list" style="flex:1; overflow-y:auto; padding:20px;"></div>
        <div style="padding:20px; background:#F7FAFC; border-top:1px solid #E2E8F0;">
            <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>Subtotal:</span><span id="cart-net">$0</span></div>
            <div style="display:flex; justify-content:space-between; margin-bottom:15px;"><span>IVA (19%):</span><span id="cart-tax">$0</span></div>
            <div style="display:flex; justify-content:space-between; font-weight:800; font-size:1.2rem; margin-bottom:20px;"><span>Total:</span><span id="cart-total">$0</span></div>
            <button class="btn-primary" onclick="openCheckout()">Ir a Pagar</button>
        </div>
    </div>
    <div id="cart-overlay" onclick="toggleCart()" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:2400;"></div>

    <script src="app.js"></script>
</body>
</html>